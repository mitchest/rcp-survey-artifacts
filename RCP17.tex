\documentclass{statsoc}
%\usepackage{fullpage} %shouldn't need this!  All formatting should be done by the class...  But when it is removed the paper margins are over run...
%\usepackage{bmpsize}
%\usepackage[dvipdfmx]{graphicx}
\usepackage{graphicx}
\usepackage{datetime}
\usepackage{color}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{multirow}
\usepackage{natbib}
\usepackage{bm}

%vectors
\newcommand{\vm}{\bm{\mu}}
\newcommand{\vz}{\bm{z}}
\newcommand{\vg}{\bm{\gamma}}
\newcommand{\vt}{\bm{\tau}}
\newcommand{\va}{\bm{\alpha}}
\newcommand{\vy}{\bm{y}}
\newcommand{\vx}{\bm{x}}
\newcommand{\vw}{\bm{w}}
\newcommand{\vpi}{\bm{\pi}}
\newcommand{\vb}{\bm{\beta}}

%matrices
\newcommand{\vX}{\bm{X}}
\newcommand{\vW}{\bm{W}}
\def\bSig\mathbf{\Sigma}
\newcommand{\VS}{V\&S}

%operators
\newcommand{\ev}[1]{{\rm E}\left(#1\right)}
\newcommand{\ex}[1]{{\rm exp}\left(#1\right)}
\newcommand{\tr}{\mbox{tr}}

\title[Grouping With Survey Artefacts]{Ecological Grouping of Survey Sites when Sampling Artefacts are Present}

\author[Foster, Hill \& Lyons]{Scott D. Foster}
\address{Commonwealth Scientific and Industrial Research Organisation (CSIRO),
		Hobart,
		Australia}
\email{scott.foster@csiro.au}
\author{Nicole A. Hill}
\address{Institute for Marine and Antarctic Studies, The University of Tasmania, Hobart, Australia}
\email{Nicole.Hill@utas.edu.au}
\author[Foster, Hill \& Lyons]{Mitchell Lyons}
\address{Centre for Ecosystem Science, School of Biological, Earth \& Environmental Sciences, The University of NSW, Sydney, Australia}
\email{mitchell.lyons@unsw.edu.au}

\begin{document}

\maketitle


\begin{abstract}
Grouping sites based on their biological information is a common goal in ecology that has scientific and management applications. Two applications are studied in this work: 1) classifying vegetation types for management units and predicting these units into unsampled space; and 2) finding assemblages of fish and investigating how these assemblages vary with covariates. Data used to find the groupings often have extraneous sources of variation, such as that related to sampling, which are often ignored but should be accounted for when finding the groupings. In ecological studies, this is increasingly common as data sets are now being combined from many smaller survey efforts. We show, through a model-based clustering method, how the groupings can be obtained, whilst accounting for extraneous variation.
\end{abstract}

\keywords{Biogeography; Clustering; Community; Mixture model; Region of common profile; Sampling artefact.}
%\keywords{Biogeography; Bootstrap; Clustering; Community; Mixture model; Mixture of experts; Multivariate; Region of common profiles; Residuals; Sampling artefact; Sampling effect; Uncertainty.}

\maketitle

\section{Introduction}\label{s:intro}

Grouping geographical locations into areas of relative biological homogeneity is a long-standing statistical task in quantitative ecology \citep[e.g.][]{qui02,man04}. It is the uniting theme in many ecological applications, including the two analyses presented in this study: 1) finding vegetation composition groups throughout the Australian state of New South Wales (NSW) for use as units for natural resource management; and 2) finding groups in sub-Antarctic fish communities to inform scientific discussion about the distribution of all components of the fish community, which will have direct implications for spatially-based and ecosystem-based management \cite{con11}.

In both of our applications, and also generally, the data consist of two parts: biological and physical. The biological data consist of a measure (e.g. counts of individuals) for each species at a number of sampling locations, and each location's vector of species observations is used to group the locations. The physical data consist of descriptors of the physical environment at the site, it can be used to explain variation in the biological data. The biological data for the vegetation and fish studies contain heterogeneity that is not of direct interest, but yet must be accounted for to obtain valid inference about the quantities of interest \citep[e.g.][]{gel13}. In the NSW vegetation data, the samples were collected using different scoring protocols throughout multiple decades. In the sub-Antarctic fish data, this heterogeneity arises as the samples are combined from three different surveys in three different years. Many, perhaps even most, ecological data used for grouping contains unwanted and ultimately uninteresting variation of some type. Generically, we label this source of variation as \textit{sampling artefacts}. Not incorporating sampling artefacts into the analysis may have the unfortunate effect of conflating patterns in sampling artefacts with ecological patterns, and lead to incorrect inferences. %The topic of this work is a method to account for sampling artefacts whilst performing groupings of sites.

Accounting for sampling is an existing issue in ecological statistics whose importance is now formally realised \citep[for example see][which all deal with the specific task of species distribution model]{war13,fit15,fer15}. In that modelling situation, the effect of sampling artefacts is adjusted for during the analysis. Here we propose to do the same for site grouping, via a model-based analysis called the ``region of common profile'' (RCP) model \citep{fos13,lyo15}. The RCP model is a multivariate adaptation of a mixture-of-expert model \citep{Jac91,mcl00}. It is by no means the only mixture model designed for use in community ecology, but it is the only one that groups the biological content of sites \textit{and} allows those groupings to be predicted at unsampled sites (through the relationships with environmental covariates). Other related models: 1) perform site grouping without covariates \citep[and allow for heterogeneity, possibly due to covariates, through a latent Dirichlet level,][]{val14}; 2) perform species (not sample site) clustering based on species' responses to covariates \citep{ova11,dun11,dun13, hui13,fos15}; 3) perform \textit{bi-clustering} where sampling sites \textit{and} species are clustered simultaneously, but in the absence of covariates \citep{ple14,fer16}; and 4) add spatial information (not general covariates) and utilise an application-specific likelihood \citep{pri00,gui05,cor08}. In addition to these grouping methods, \citet{hui15c,war15a,ova15,ova16} all utilise continuous, not discrete, latent variables, which could increase model flexibility at the cost of categorised interpretation. We feel that the categorised (grouped) interpretation: a) makes inferences easier to understand, b) simplifies explanation of results to a broader range of scientists/managers/public, and c) is at the very core of the research questions tackled here.

%In this work, we focus on the analysis of two data sets (described in Sections \ref{ss:vegData} and \ref{ss:fishData}), which have very different attributes but both contain sampling artefacts. The NSW vegetation data is a large presence-absence data set and the sub-Antarctic fish data set is smaller and consists of species' counts. We analyse the data using a model described in Section \ref{s:model}, which is an extension of that described in \citet{fos13}. We show: 1) how sampling artefacts can be included in the clustering method, 2) the effect of sampling artefacts on the analysis of two data sets, 3) how the model can be checked against systematic departures from modelling assumptions using graphical diagnostics, and 4) how the method has been extended to accommodate different types of data (presence-absence, counts and biomass).



%Grouping geographical locations into areas of relative biological homogeneity is a long-standing statistical task in quantitative ecology \citep[e.g.][]{qui02,man04}. It is the uniting theme in many ecological applications, including the two analyses presented in this study: 1) finding vegetation composition groups throughout the Australian state of New South Wales (NSW) for use as units for natural resource management; and 2) finding groups in sub-Antarctic fish communities to inform scientific discussion about the drivers of fish community structure in a remote and inhospitable environment. Despite the importance of applications, the statistical task of ecological grouping has not enjoyed the focus of modern statistical methods, such as model-based grouping \citep[e.g.][]{mcl00}, which is in contrast to similar applications in landscape genetics \citep[see][]{pri00,gui05,cor08}. Model-based methods allow for group determination and potentially can show how these biological groups depend on environmental covariates \citep{fos13}. They also offer flexible and direct descriptions of the data, not indirect descriptions through arbitrary functions of the data (e.g. distance measures). Importantly, model-based methods offer a setting for model selection, diagnostics, prediction and transparency through formality \citep[see][]{war15}.

%In both of our applications, and also generally, the data consist of two parts: biological and physical. The biological data consist of a measure (e.g counts of individuals) for each species at a number of sampling locations, and each location's multivariate vector of species observations is used to group the locations. The physical data consist of descriptors of the physical environment at the site, it can be used to explain variation in the biological data. Both the biological data for the vegetation and fish contain heterogeneity that is not of direct interest in the analysis. In the sub-Antarctic fish data, this heterogeneity arises as the samples are combined from three different surveys in three different years. In the NSW vegetation data, the samples were gradually collected using different scoring protocols throughout multiple decades. Many, perhaps even most, ecological data used for grouping contains this type of variation and will be present in data that combines surveys to increase spatial and/or temporal coverage. Generically, we label these variations as \textit{sampling artefacts}, which can arise from different sampling procedures, different personnel, different methods of scoring, and different measuring equipment, just to name a few. Not incorporating sampling artefacts into the analysis may have the unfortunate effect of conflating patterns in sampling artefacts with ecological patterns, and lead to incorrect inferences. This is an emerging issue in the analysis of ecological presence-only data, where sampling intensity confuses the quantification of individual species' geographic distribution. Some developments have already been made for the analysis of presence-only data \citep[see][]{war13,fit15,fer15}. In that situation, extra sources of variation have been added to the modelling process to account for the sampling artefacts.

%In a model-based analysis for finding groups, sampling artefacts can be accounted for and we show how this can be done for the sub-Antarctic fish, NSW vegetation data, and generically. Our approach uses an extension of models already established in the literature \citep[namely mixture-of-expert models;][]{Jac91,mcl00,fos13}. This guards against conflating sampling artefacts with the grouping variation that is of primary interest. This approach brings the task of ecological grouping into line with the analysis of data arising from any survey or from a designed experiment. In those situations, it is routine to include the sampling artefacts (although variously called blocks, covariates or strata) in the analysis. Further, generalist textbooks \citep[such as][Chapter 8]{gel13} state: ``The information used in data collection must be included in the analysis, or else inferences will not necessarily be appropriate for the general population of interest''. That is, the generalisability of results to the ecological process will be compromised if sampling artefacts are ignored. 

%The modelling framework utilised in this work \citep[the ``region of common profile'' (RCP) model, described in][]{fos13,lyo15} is a multivariate adaption of a mixture-of-expert model \citep{Jac91,mcl00}. It is by no means the only mixture model designed for use in community ecology, but it is the only one that groups the biological content of sites \textit{and} allows those groupings to be predicted at new sites (through the relationships with environmental covariates). Other related models: 1) perform site grouping without covariates \citep[and allow for heterogeneity, possibly due to covariates, through a latent Dirichlet level][]{val14}; 2) perform species (not site) clustering based on species' responses to covariates \citep{ova11,dun11,dun13, hui13,fos15}; 3) perform \textit{bi-clustering} where sampling sites \textit{and} species are clustered simultaneously, but in the absence of covariates \citep{ple14,fer16}; and 4) add spatial information (without covariates) and utilise an application specific likelihood \citep[an admixture model in genetics]{pri00,gui05,cor08}. In addition to these grouping methods, \citet{hui15c,war15a,ova15,ova16} utilise continuous, not discrete, latent variables, which could increase model flexibility at the cost of categorised interpretation. We feel that the categorised (grouped) interpretation: a) makes inferences easier to understand, b) simplifies explanation of results to a broader range of scientists/managers/public, and c) is at the very core of the research questions tackled here.

%In this work, we focus on the analysis of two data sets (described in Sections \ref{ss:vegData} and \ref{ss:fishData}), which have very different attributes but both contain sampling artefacts. The NSW vegetation data is a large presence-absence data set and the sub-Antarctic fish data set is smaller and consists of species' counts. We analyse the data using a model described in Section \ref{s:model}, which is an extension of that described in \citet{fos13}. We show: 1) how sampling artefacts can be included in the clustering method, 2) the effect of sampling artefacts on the analysis of two data sets, 3) how the model can be checked against systematic departures from modelling assumptions using graphical diagnostics (residual plots), and 4) how the method has been extended to accommodate different types of data (presence-absence, counts and biomass).

\subsection{NSW Vegetation Data}\label{ss:vegData}

New South Wales (NSW) is a state on the east coast of Australia, which has an area of $\sim$809,000km$^2$ (see Figure \ref{figMap}). We analyse 4715 sample sites in remnant native vegetation, as presence-absence observations. This is a subset of all sites available from the NSW office of Environment and Heritage Vegetation Information System database (see \verb|http://www.bionet.nsw.gov.au/| -- subsetted for computation times. The subset was chosen so that the samples were reasonably spatially balanced by choosing the nearest sampled point to a set of spatially balanced points. This process retains coverage of the entire state and the spatially varying covariates. Samples consisted of observations of all species' within a 20m$\times$20m plot, in which all vascular plants were exhaustively recorded by a botanist using one of a number of well-defined protocols (ordinal scores, presence-absence and exhaustive counts) -- we removed protocols that were seldomly used and degraded all quantity information to presence-absence so that all observations will have equal contribution to the analysis. The date of sampling was also recorded (we exclude sites before 1980, since they did not have reliable records of survey method). We removed any species with less than 50 occurrences -- since they are unlikely to provide substantive information for distinguishing biogeographic quantities -- leaving 488 species. Sites spanned a range of structural vegetation types, including rainforests, wet and dry sclerophyll forests, grassy woodlands, shrublands, heathlands, riparian vegetation, and freshwater/saline wetlands \citep{kei04}. These data are provided in the supplementary materials.
\begin{figure}
	\centering
	\includegraphics[keepaspectratio=true, width=0.9\linewidth]{./plots/Nov16/Maps1.eps}
	\caption{\label{figMap}\textit{Top:} Map showing the location of the state of New South Wales and the Kerguelen Plateau. \textit{Bottom Left:} Vegetation survey locations across New South Wales, Australia. Shape and colour depicts survey method, and the solid black line shows the state border. \textit{Bottom Right:} Fish survey locations. Shape and colour depict survey period. Contour lines represent bathymetry and range from 200m depth (lightest blue) to 1000m depth (darkest blue) in steps of 100m. The Islands in the bottom of the plot are the Heard and McDonald Islands.}
\end{figure}

\subsection{Sub-Antarctic Fish Data}\label{ss:fishData}

Benthic fish were sampled from three surveys conducted on the Kerguelen Plateau surrounding Heard and MacDonald Islands, an Australian external territory (see Figure \ref{figMap}) of $\sim$130,000km$^2$. The Kerguelen Plateau is a large isolated feature that rises sharply from abyssal depths in the Southern Indian Ocean. It is topographically complex and interrupts the flow of the Antarctic Circumpolar Current, creating sharp environmental gradients that are thought to structure biological communities. The region is also highly productive, supporting commercially important fisheries for icefish and toothfish. Surveys were conducted by the Australian Antarctic Division in May--June 1990 (Austral winter), January--February 1992 (Austral summer) and September 1993 (Austral Spring) using a 35m headline bottom trawl, with a 5cm codend liner, towed along the bottom for approximately 30 minutes at 3 knots \citep{wil95}. A total of 65,801 individuals from 25 benthic fish species were recorded at 181 sites across all surveys. For the present analysis, we consider the abundance (counts) of the 15 species that were present at 8 or more sites. We removed the rarer species as they do not provide much information about biogeographies. These data are available online, see \citet{hil15}.

\section{Statistical Model}\label{s:model}

We start the description of the model by formally specifying what we mean by biological \textit{relative homogeneity} between sites. Define $y_{ij}$ to be the species datum for species $j$, $j=1\ldots S$ at site $i$, $i=1\ldots n$. Each datum's expectation is denoted by $\mu_{ij}$, which can be formed into a vector $\vm_i$ for all species at a site (the site's \textit{profile}). We say that a group of sites are biologically similar, and in the same group, if $\vm_i\approx\vm_{i^\prime}\approx\vm_k$ for sites $i$ and $i^\prime$ (groups indexed by $k=1\ldots K$). So, all sites within a group have a \textit{constant profile}. This has previously lead to a natural label for the groups of ``regions of common profiles'' \citep[RCPs;][]{fos13,lyo15} and we shall continue that nomenclature but note that they could be labelled ``groups'', ``clusters'', ``components'', ``classes'', ``bioregions'', ``ecoregions'', ``assemblages'' or ``communities''. Conversely, we note that if $\vm_i$ is not approximately equal to $\vm_k$ then site $i$ is not associated with group $k$. Of course, this definition rests on what is meant by `approximately equal' and we suggest that this should be dependent on the amount of information contained in the data -- larger, more informative data will allow for less variation within a group (and less variation between groups). The RCP approach gives a stepped function for the distribution of each species where the step locations, but not step sizes, are common across species.

For the sake of exposition, temporarily assume that we know which RCP each site belongs to. For site $i$ this is stored in the $K\times1$ indicator vector $\vz_i$, which is zero everywhere except for a 1 in the $k^{th}$ element. We define an RCP model for the $j^{th}$ species at site $i$ as
\begin{align}
	g(\ev{y_{ij}|\vz_i}) &= g(\mu_{ij})=\alpha_j+\vz_i^\top\vt_j +\vw_i^\top\vg_j+\nu_i,\label{e:condMod}
\end{align}
where $g(\cdot)$ is a link function, $\alpha_j$ is the mean parameter (on the link scale) for the $j^{th}$ species, $\vt_j$ is a $K\times1$ vector of species parameters containing the step changes for each RCP, $\vw_i$ is a vector of covariates reflecting sampling artefacts at site $i$, $\vg_j$ is a vector of species-specific parameters, and $\nu_i$ is an offset term for site $i$ that is added to the model as a constant. The offset is commonly used in models with a log-link function, where it describes the exposure of the sample (e.g. the logarithm of trawl length in fish surveys). This model is based on that used in \citet{fos13} and \citet{lyo15}, except for two details that will be exploited in this paper. The first is the presence of the species-specific term $\vw_i^\top\vg_j$, which accommodates sampling artefacts and does so separately for each species. This term is common to all RCPs and reduces/increases the expectation of each species by the same amount for all RCPs. The second difference is that only the logit link was considered for $g(\cdot)$, whereas \eqref{e:condMod} is more general. In particular for ecology, the log link and identity link are commonly be used. 

The model in \eqref{e:condMod} resembles a generalised linear model (GLM) and we continue this analogy by specifying a sampling distribution for $y_{ij}|\vz_i$, denoted by $f(y_{ij}|\vz_i)$. In theory, $f(y_{ij}|\vz_i)$ could be any distribution whose mean is given by \eqref{e:condMod} but we find that the following are useful for many ecological data sets: Bernoulli, Normal, Poisson, Negative Binomial \citep[see][]{law87,ven02}, and Tweedie \citep[see][]{smy96,fos13a}. This is not an exhaustive list though, and others could be added. Any dispersion parameters should be estimated but in some cases it is convenient to specify them, as in the case for the Tweedie power parameter \citep[but see][]{fos13a}. The distribution of the $i^{th}$ site's data, $\vy_{i\cdot}$, is taken to be the product of the individual species distribution, that is $f(\vy_{i\cdot}|\vz_i)=\prod_{j=1}^Sf(y_{ij}|\vz_i)$.

We now acknowledge that we do not observe $\vz_i$ and treat it as a latent factor, which changes the model into a mixture model \citep[see][]{mcl00}. We assume that $\vz_i$ is the result of a multinomial sampling process with one trial and $k\times1$ probability vector $\vpi_i$. We employ a mixture-of-experts model \citep{Jac91,mcl00} to allow the RCP probability vector $\vpi_i$ to vary depending on the observation site's position in environmental and geographical space, that is $\vpi_i=h(\vx_i)$ where $\vx_i$ contains the environmental and/or geographical covariate data for site $i$. We choose $h(\cdot)$ to be the additive logistic function \citep{ait82} whose $k^{th}$ element is
\begin{align}
	\pi_{ik}& \triangleq h(\vx_i,k)=
	    \begin{cases}
	    	\frac{\ex{\vx_i^\top\vb_k}}{1+\sum_{k'=1}^{K-1}\ex{\vx_i^\top\vb_{k'}}},&\text{if $1\leq k \leq K-1$}\\
	    	1-\sum_{k'=1}^{K-1}\pi_{ik'},&\text{if $k=K$},\label{eqMultLogit}
	    \end{cases}
\end{align}
where $\vb_k$ holds the parameter values for the $k^{th}$ linear combination ($k=1\ldots K-1$). This link was chosen as it parameter transforms probabilities (that sum to one) to a set of unconstrained parameters, which are easier to estimate. We arbitrarily choose the convention that the $K^{th}$ RCP to be the reference group, but any RCP could be chosen.

In summary, the RCP model has the following components: 1) a model for the RCP type, which is dependent upon environmental/geographical covariates, see \eqref{eqMultLogit}; 2) a model for the expectation of each species' observations, that can include potential survey artefacts, see \eqref{e:condMod}; and 3) a probability/density model for how the observations vary around their expectation. The model is qualitatively different from methods that group solely on biological or physical data alone and will naturally provide different interpretations \citep[see][for a worked example]{fos13}. We now go through specific aspects of the model: how to interpret it; how to estimate it, and; how to quantify uncertainty due to data variation. We provide a supplemental appendix for graphical diagnostic measures based on residuals a influence measures.

%This model extends that of \citet{fos13} but still remains a mixture model, which is widely used in all disciplines where statistical methods are employed. Contrasts and comparisons with other grouping methods used in ecology are found in \citet{fos13}. Similar ideas have been taken up by other authors, most notably \citet{ple14} and \citet{val14}. Both of these sets of authors do not explicitly accommodate covariates into their model, which makes prediction into new locations impossible and can falsely inflate the variation in parts of the model, unless there are no covariates that affect the outcomes. Extra variation has been included in \citet{val14}, as a Dirichlet-multinomial latent factor (as opposed to a multinomial in mixture models). While we think that Dirichlet-multinomial latent factors has many good qualities, we prefer to try to understand the variation more completely by using covariates.

\subsection{Model Interpretation}

For most analysis purposes, like both analyses presented in this work, interest is in the biogeography that the model describes. This is the probability of each RCP type occurring at each prediction location. This is directly available through \eqref{eqMultLogit} with uncertainty estimates (see Section \ref{SectBoot}). For predicting sampled sites another option is available and is given, for the $i^{th}$ site and $k^{th}$ RCP group, by
\begin{equation}
	\ev{z_{ik}|\vy_{i\cdot}}=\frac{\pi_{ik}f\left(\vy_{i\cdot}|z_{ik}=1\right)}{\sum_{g=1}^K\pi_{ig}f\left(\vy_{i\cdot}|z_{ig}=1\right)},\label{ePostProbs}
\end{equation}
which is conditional on plug-in estimates for the model's parameters and conditions the site's $S$ species' data ($\vy_{i\cdot}$). This expectation differs from \eqref{eqMultLogit} which is the \textit{unconditional} expectation. The mixture model literature commonly refers to \eqref{ePostProbs} as a posterior probability of component membership \citep[e.g.][]{mcl00} and it provides a more accurate prediction of a sites RCP membership as it takes into account environmental covariates \textit{and} the sites biological data.

\subsection{Estimation}\label{SectEsti}

We estimate the model following the general scheme given in \citet{fos13}, which is a maximum penalised likelihood estimate. The penalisation used is mild, just enough to stop ridiculous solutions being found. Whilst applying this model to other data sets \citep[see][]{lyo15} we found that additional mild penalties on the $\{\vt_j\}_{j=1}^S$ were beneficial as it reduced the number of local maxima and improved convergence to the (possibly local) maxima. We do not use these penalties as informative priors on the parameters, rather just as a computational tool. We penalise the $\{\vt_j\}_{j=1}^S$ as if they were a normal variate with mean 0 and standard deviation 10. For the same reasons, we also penalise $\{\vg_j\}_{j=1}^S$ with a similar penalty, and we penalise the dispersion parameter (if specified in the model) as a log-normal with log-mean and log-variance both equal to 10. %The penalty on the dispersions produces slight shrinkage towards a dispersion of 1. % We do not provide a simulation study for the estimation process as: 1) a simulation study for the base model was provided in \citet{fos13}, which showed that parameters were estimated effectively, and 2) it is based on the well established principles of (penalised) maximum likelihood, which is known to have good estimation properties.

To guard against making inference from a local maximum, we perform many optimisations from random starting values as outlined for RCP models in \citet{fos13}. Whilst we cannot safely recommend an optimal number of random starting values, we can give some guidance about the data and model attributes that are likely to require more random starts: 1) model complexity (more RCP groups, more covariates and more sampling artefacts), 2) fewer species (especially non-rare ones), and 3) less sampling sites. Performing multiple sets of multiple starts could provide a useful diagnostic to see if enough starts have been performed. If this were done, and the same estimates were found in each set, then the analyst could be confident that each set contained enough starts. This was done, albeit informally as part of model development, in the analyses presented in this work.

Mixture models are prone to spikes in the likelihood \citep[eg][]{mcl00} and in the RCP model, this is shows when the estimation generates RCP groups that do not have many, or any, sampling sites that have affinity to it. Fortunately, these can be identified and removed from the set of model fits as they have very small posterior mass, defined in \eqref{ePostProbs}, for all sites. This can be measured as the sum (over sites) of the posterior probabilities in \eqref{ePostProbs}.

\subsection{Parameter and Prediction Uncertainty} \label{SectBoot}

Estimation of uncertainty is central to interpreting the results in a statistical context. For the RCP model (equations \eqref{e:condMod} and \eqref{eqMultLogit}), estimated from maximum likelihood methods, there are a number of viable options available. Here, we concentrate on bootstrap methods \citep[see][]{dav97}, although other methods are available -- \citet{fos13} used the curvature of the log-likelihood.

We follow \citet{mcl00} and use the estimates from the un-perturbed data as starting values for each of the bootstrapped data sets. The reason for using these starting values is two-fold: 1) it (almost) removes the possibility of the groups swapping labels between bootstrap samples, and 2) decreases computation time substantially. For the RCP model the objects of bootstrap sampling are the sites' data $(\vy_i, \vx_i, \vw_i)$. This approach has the additional benefit of preserving correlations amongst species within a site. With RCP models, we prefer to use the Bayesian bootstrap \citep{rub81}, rather than case-resampling bootstrap \citep[see][]{dav97}, as the Bayesian bootstrap never completely removes a site's data. This could be important for small data sets when not including a certain combination of sites in the bootstrap sample could inadvertently also remove all information about a parameter. %While we are yet to encounter this behaviour, we acknowledge it is possible.

%Having multiple methods to estimate the uncertainty can be a diagnostic tool. If there is any discrepancy between the method then it may indicate problems with the way that the model is specified.

Uncertainty in predictions can be propagated through the model from the parameters -- for predicting RCP types, through equation \eqref{eqMultLogit}. This is achieved by taking the empirical distribution of estimates (from bootstrapping) and calculating the predictions for each set of bootstrap estimates. If desired, variances of estimates (standard errors) and covariances can be obtained by taking the empirical variances of the bootstrap samples.

\section{Data Analysis}

\subsection{NSW Vegetation Data} \label{SectVegAnal}

We chose a set of seven covariates that we thought likely to affect the distribution of vegetation types and/or the species that constitute them. The covariates are: maximum summer temperature, minimum winter temperature, annual rainfall, rainfall seasonality, topographic roughness, soil density and soil pH. All covariates were added as quadratic polynomials into the model describing the probability of observing each RCP type (see \ref{eqMultLogit}). Details on the provenance, resolution, and methodology of the covariates are provided in Table S.1.

For the model of expectation for species' presence-absence observations \eqref{e:condMod}, we included the date the observation was made as a linear effect and the survey method as a categorical term (whether the data was measured as presence/absence, cover-abundance score, or species' counts prior to conversion to presence-absence). Since, we are interested in a single (time independent) description of the vegetation of NSW, we included date in the species dependence model \eqref{e:condMod}. However, if a time-changing description was desired then date could be added to the RCP model \eqref{eqMultLogit}. Estimation of model with a small number of RCPs took $\sim$1 hour and larger, more complex models too nearly 8 hours. Parallelisation on a large computing cluster made multiple starts feasible.%Date was included in the species dependence model \eqref{e:condMod} because the occurrence of individual species was likely to change over time, and this drift, particularly at large geographical scales, was not of primary interest when investigating biogeographies. %We did not have a strong \textit{a priori} assumption for how survey methodology would effect species observations, but it is certainly possible and worth accounting for. 

For the sake of comparison, we estimated the RCP model both with and without the sampling artefacts. After some initial model exploration for determining an appropriate range for the number of RCPs, we chose to investigate more fully the range of 2 to 30 RCPs and in particular the range 4 to 12. We used 100 random sets of starting values for optimisation at each of 2 to 30 RCPs and 500 for 4 to 12. To reduce computational effort, less sets of starting values were used for less likely numbers of RCPs. The model, with sampling effects, that minimised BIC had 6 RCPs (see Figure S.1) whilst the model that minimised BIC with no sampling effects had 8 RCPs. We note that the optimisation process for both models, but especially the model without sampling effects, identified local maxima (see Figure S.1). Some of these local maxima appeared to be `empty' in the sense that they had RCP groups with no, or few, sampling locations associated with them -- see Section \ref{SectEsti}. % Also, for larger numbers of RCP groups, particularly for the model with no sampling effects, a global maximum in log-likelihood may not have been obtained (as evidenced by large variation in the minimum BIC values in Figure \ref{NSWVegBIC}). For this analysis however, this is immaterial as the BIC values for neighbouring models are substantially higher than for those near the minimum.

The increase in the number of RCP groups, between the models with and without the sampling effects,  shows a perceived increase in complexity of the biogeography. Also, the minimum BIC was similar between the two models, implying that both models produced similar fits to the data but did so under different assumptions about process. Model diagnostics were performed using the randomised quantile residuals and leave-out statistics, both described in the supplementary materials, and neither model showed any real indication of lack-of-fit (see supplemental Figures S.2, S.3 and S.4).

The sampling terms, when included, showed that there is substantial variation in the different scoring methods for each species. These terms are estimates of  $\{\vg_j\}_{j=1}^S$ in \eqref{e:condMod} and are given in Figure \ref{NSWVegGammas}. It seems that recording species with cover-abundance scores on a 1--6 scale increased the chance of observing many species compared to recording counts, but a smaller number species had a decreased chance. Observing a difference in survey method is an interesting finding, warranting further investigation -- some survey methods are more time-intensive than others. The results showed that date sometimes had a substantial effect ( up to 2 units on the logit scale per year) for some species, but there was no strong or obvious trend across species, with species both becoming more and less prevalent.
\begin{figure}
	\centering
	\includegraphics[keepaspectratio=true, width=0.6\linewidth]{./plots/Nov16/NSWVegRCP6_gammas.eps}
	\caption{\label{NSWVegGammas}\textbf{\textit{NSW vegetation data:}} distribution of the estimated sampling effects from the model fit with species dependence on survey method and date. The survey method parameters are a contrast against the species-count method and the date variable is measured in years (so that the coefficient gives logit units per year).}
\end{figure}

Predictions were made for the entire state of NSW on a 2km grid and uncertainty was quantified using 95\% confidence intervals from 1000 bootstrap replications. We predicted probabilities of observing each RCP type for both the models (with sampling effects in Figure \ref{NSWVegRCP5Map}), without sampling effects for 8 RCPs (Figure S.5), and without sampling effects for 6 RCPs (Figure S.6). The last set of predictions gives comparison of only the effect of sampling effects and not the whole analysis process. The confidence intervals for the RCP predictions are marginally narrower for the model with sampling effects (6 RCPs) than for the model without them (8 RCPs), implying that some of the sampling variation is contributing to the uncertainty in the predicted quantities. However, the confidence intervals for the model with no sampling effects and 6 RCPs had narrowest confidence intervals (Figure S.6), which is an issue we will return to in the Discussion. For many locations the bootstrapped confidence intervals were wide for all models, indicating geographical areas and/or RCP types that are not very well defined either through lack of biological data, missing important environmental covariates, both, or an inherently low-information process. \begin{figure}
	\centering
	\includegraphics[keepaspectratio=true, width=0.9\linewidth]{./plots/Nov16/NSWVeg_SpeciesModel_preds.eps}
	\caption{\label{NSWVegRCP5Map}\textbf{\textit{NSW vegetation analysis:}} The spatial distribution of RCP membership probabilities for the an RCP model with 5 groups and sampling effects. This number of RCP groups minimised BIC for this model. \textit{Left column:} lower 95\% confidence interval for group membership probability. \textit{Central column:} point prediction. \textit{Right column:} upper 95\% confidence interval. Intervals based on 1000 bootstrap realisations, see Section \ref{SectBoot}}
\end{figure}

When compared to a map of vegetation formations in NSW \citep[][a classification based on an almagamation of many local to regional scale vegetation maps]{kei12}, the RCP probabilities, both with and without sampling effects, had generally good fidelity for some vegetation classes but not others (see Table S.2). However, there were differences between the two RCP models in their comparability to the vegetation formations. For the model with sampling effects (see Figure \ref{NSWVegRCP5Map}): Semi-arid Woodlands (both the Shrubby and Grassy subformations); Arid Shrublands (both the Acacia and Chenopod subformations); Forested and Freshwater Wetlands; and Wet Sclerophyll Forests (both Shrubby and Grassy subformations) are all well preserved by an RCP or a small combination of them. However, the Dry Sclerophyll Forests (both Shrubby and Grassy subformations), Grasslands and Grassy Woodlands all showed no clear relationships to any RCPs. The model without sampling effects (see Figure S.5) preserved the following vegetation formations: Semi-arid Woodlands (only the Grassy subformation); Arid Shrublands (only the Acacia subformation); and Wet Sclerophyll Forests (both Shrubby and Grassy subformations). The model with no sampling effects did not reflect all vegetation formations, notably: Dry Sclerophyll Forests (both Shrubby and Grassy subformations), Forested and Freshwater Wetlands, Grasslands and Grassy Woodlands. 

%We note however, that it is not trivial to assess RCPs at the state-wide scale, since a large proportion (almost exclusively the eastern half) of NSW is cleared land; vegetation maps show these areas as cleared land, whereas our RCP analysis attempts to adjust for the clearing pattern, through the date covariate in \eqref{e:condMod}. {\color{blue} Mitch: we need to talk about this, and Referee 1's comment}

As a further check of the coherence of our analyses, we compared RCPs to established bioregions \citep{tha97}, which are expert derived classifications that holistically integrate a range of biotic and abiotic data sets. The predictions from the RCP model (with and without sampling) delineate the coastal and tableland bioregions from the bioregions on the western side of the Great Dividing Range and the NSW interior. Also, the RCP models delineated the structure of the \textit{Darling Riverine Plains} and \textit{Riverina} (see RCP 2 in Figure \ref{NSWVegRCP5Map} and RCP 2 and RCP 4 in Figure S.5), and their boundaries with the \textit{Mulga}, \textit{Murray Darling Depression} and \textit{Cobar Peneplain} (see RCP 1 in Figure \ref{NSWVegRCP5Map} and RCP 4 in Figure S.5). Again there were generally similar patterns between the models fitted with (6 RCPs) and without sampling artefacts (8 RCPs).

A very large proportion of NSW has been cleared, predominantly for agricultural purposes. This is particularly so for the eastern half of the state, to the west of the ranges. Vegetation was not sampled in cleared land, with samples only placed in remnant patches of native vegetation. This means that these data, and the RCP analysis of these data, are essentially `blind' to clearing. This creates a unique opportunity in an ecological context in that it offers some insight into what the vegetation structure might have been like if clearing had not taken place. For example, RCPs 4 and 5 were mapped in areas that almost entirely cleared landscapes (Figure \ref{NSWVegRCP5Map}). We stress though that the RCPs predicted into cleared areas are naturally biased towards the remnant vegetation types that were sampled. The most heavily cleared vegetation formations, the \textit{Dry Sclerophyll Forests}, \textit{Grasslands} and \textit{Grassy Woodlands} \citep{kei04} showed the least fidelity to our RCPs, as measured by the strength of the posterior probabilities in \eqref{ePostProbs}. A potential explanation for this is that the collection of remnants of these vegetation types are eclectic, with the vast majority of these vegetation types having been cleared, so it is possible that site sampling is simply biased towards areas that are more variable in terms of the model of RCP dependence on environmental covariates.

\subsection{Sub-Antarctic Fish Data}\label{SectFishAnal}

Environmental variables likely to influence the distribution of fish living near the sea-floor (demersal) fish were compiled from various sources (see Table S.2) and include: depth, sea floor slope, sea surface productivity, sea floor temperature, sea floor salinity, and sea floor current speed. Environmental variables were initially screened by fitting a generalised additive model (GAM), with negative binomial sampling variation, for each environmental variable and each species separately, and any that were significant at p$<$0.1 for at least two-thirds of species were used in the RCP modelling process. The negative binomial distribution was used here as it provides a mechanism to allow a species to be over-dispersed (due to fish shoaling). This process selected three variables: longitude, depth and sea floor temperature. We included each variable as a quadratic term in \eqref{eqMultLogit} as all the GAM fits were approximately quadratic or linear for most species.

The Season/Year of surveys was considered as a sampling artefact as fluctuations in the abundance of individual species are likely. Although we would routinely include the Season/Year factor in any model-based analysis, as it is a known source of variation, we compare models that are fitted with these covariates affecting the species-level model and models fitted without it. The RCP model assumed negative binomial sampling variation with a log link function. The (penalised) log-likelihood was maximised using 1000 random starts in the method described in Section \ref{SectEsti}. The entire model fitting process took under 5 minutes on a 2.3 GHz Linux machine with 6 cores. The final model took 1.2 seconds to fit from a random start.

To determine an appropriate number of RCPs, models with one to six RCPs were fitted and compared using BIC, as defined in \citet{fos13}. We found that 3 RCPs minimised BIC for both models (6816.9 with artefacts and 6815.2 without -- see Figure S.7 in the supplementary materials). We note that the minimum BICs from both models is very similar (a difference of around 2 BIC units). Both models produce diagnostic measures (see supplementary materials) that indicate no model mis-specification (see Figures S.8, S.9 and S.10). We predict the probability of each RCP type, from \eqref{eqMultLogit}, throughout the region and quantify uncertainty using a 95\% confidence interval from 1000 bootstrap samples. The two sets of maps are very similar to each other. The predicted map for the model with sampling effects is given in Figure \ref{figKerguelenPreds1} and the predicted map for the model with no sampling effects is in Figure S.11.
\begin{figure}
 \centering
 \includegraphics[keepaspectratio=true, width=1\linewidth]{./plots/Nov16/SpPreds_withSamp1.eps}
 \caption{\label{figKerguelenPreds1}\textbf{\textit{Sub-Antarctic fish analysis:}} Predictions of probability of observing each of the RCPs, from model with sampling effects, for the sub-Antarctic fish data. \textit{Left column:} lower 95\% confidence intervals from bootstrap predictions. \textit{Central column:} point predictions. \textit{Right column:} upper 95\% confidence interval from bootstrap predictions.}
\end{figure}

RCP group 2 is primarily associated with the banks, ridges and shallow areas of the plateau, whilst RCP 1 is associated with the deeper sections of the plateau. RCP 3 is associated with shallow sections on central to eastern side of the plateau. Average abundances, conditioned to sampling in Autumn 1990, for all species in each RCP are presented in Table S.4. RCP 2 is characterised by moderate abundances of \textit{Lepidonotothen squamifrons} (Grey rock cod) and low abundances of icefish (\textit{Champsocephalus gunnari} and \textit{Channichthys rhinoceratus}), see Table S.4. RCP 1 is characterised by several deepwater species such as \textit{Macrourus holyotrachys} and \textit{Lycodapus antarcticus} and RCP 3 is characterised by high abundances of icefish. The distribution of the four abundant and commercially targeted species (\textit{Champsocephalus gunnari}, \textit{Channichthys rhinoceratus}, \textit{Lycodapus squamifrons} and \textit{Dissostichus eliginoides}) largely agrees with previous studies in this region \citep{wil95,del98}. Our analysis also adds information about composition of assemblages, including less abundant and less studied species. Depth is an important variable discriminating RCP 1 from the others -- this re-enforces the ubiquity of depth in structuring marine assemblages. In addition to improving our understanding of the structure of assemblages and their environmental drivers in this ecologically important region, RCP analyses can aid spatial management by providing an assessment of the representativeness of the current Marine reserve surrounding Heard and MacDonald Islands \citep{hil16} and provide information to support ecosystem-based management.

The sampling effects are summarised in Figure \ref{figKerguelenSamp}. For some species, there is a large variation in the abundances caught in the different surveys, e.g. \textit{Muraenolepis sp} whose spring coefficient would imply that it was rarely encountered in that survey. The uncertainty in the estimates is large making definitive statements difficult. However, for several species there seems to be fewer fish caught in spring (1993) than in autumn (1990) and summer (1992). It is clear though, that there is non-trivial variation due to sampling when all effects are taken together.
\begin{figure}
 \centering
 \includegraphics[keepaspectratio=true, width=0.6\linewidth]{./plots/Nov16/Fish_samplingEffects1.eps}
 \caption{\label{figKerguelenSamp}\textbf{\textit{Sub-Antarctic fish effects:}} Estimated sampling coefficients for each species. The coefficients are relative to the autumn sampling event. Interval estimates are the 95\% confidence intervals obtained from bootstrapping.}
\end{figure}

The RCP model, defined in Section \ref{s:model}, makes assumptions about the structure of the variability in the data (like any model). Of particular concern for the fish data is the assumption of the independence of the sampling effects, in \eqref{e:condMod}, and the biogeographical effects, in \eqref{eqMultLogit}. This assumption will be violated if fish species migrate and differentially utilise the physical environment. With the fish data we can check this by fitting the model to subsets of the data (corresponding to the different sampling events). The results, while not presented here, gave biogeographies that were similar to the combined data with the sampling effects. %However, there was less evidence in the data for 3 RCP groups and 2 RCP groups were preferred. This is a natural result as the analysis is performed on a subset of the data, which has less information.{\color{green}NICOLE: Then how are they similar!?? DO we need to provide the results or more details?? I'd have to look them up. \color{red} SCOTT: I don't think so, the reviewer's didn't ask for it and we have to draw a line somewhere...}


\section{Summary and Discussion}\label{SectSummDis}

In this paper, we have shown how survey artefacts can be included into an ecological classification of sites (Section \ref{s:model}). The classification is based on the sites' biological observations and the probability of membership to each RCP, for each site, is allowed to vary with environmental covariates, which allows prediction of classification to unsampled sites with associated measures of uncertainty. We present two examples of this analysis: vegetation presence-absence data covering the entire state of NSW (Sections \ref{ss:vegData} and \ref{SectVegAnal}) and abundance data of sub-Antarctic fishes on the Kerguelen Plateau (Sections \ref{ss:fishData} and \ref{SectFishAnal}). The two analyses had quite different responses to the inclusion of sampling effects. The NSW vegetation data produced a model that was biogeographically more complex when survey effects were ignored. This is intuitive from a modelling point of view; the variation in the data due to sampling effects is explainable as ecological effects. This example highlights that inferences can be affected by ignoring sampling effects. However, it is not always affected, as is the case for the sub-Antarctic fish data where the sampling effects do not alter the inference from the model substantially. This is in spite of there being some substantial estimated sampling effects (see Figure \ref{figKerguelenSamp}).

The ability to combine data from surveys enables creation of data sets that are spatially more extensive (and well covered). This in turn offers the prospect of creating a bioregionalisation (classification of a region into homogeneous entities) that is solely data-driven. This should be compared with many of the bioregionalisations currently in existance, where the data only form the back-drop that inform opinions of experts \citep[for example][]{tha97}. A purely data-driven approach would complement the expert's opinions and would allow: 1) for an objective critique that could highlight deficiencies in current understanding; 2) better accounting for uncertainty in conservation decision making processes \citep{bur05}; and 3) biogeographies that are transparent, have good predictive performance, and that adequately account for both biological and environmental data \citep[see][for a disucssion of why these are beneficial]{mcg06}.

Both the presented analyses (Sections \ref{ss:vegData} and \ref{ss:fishData}) show different patterns of response to sampling artefacts. The fish analysis suggests that the sampling artefacts did not alter the inference substantially as the groupings did nor did measures of uncertainty. This leads us to the question of ``For the purposes of grouping sites, when is it safe and/or sensible to ignore survey effects?'' Obviously, for the sub-Antarctic fish data it was safe, but an analyst would not know that without fitting the model with sampling effects. In general, the default situation should be that the sampling effects will be included in the model, unless they are shown to have no effect. This is a standard approach used by analysts in many application areas, including agriculture where the sources of variation due to experimental design are routinely included (e.g. blocking factors or covariates in an ANCOVA). Also, and more generally, it is the approach recommended in generalist text books, such as \citet[][Chapter 8]{gel13}. Those authors concisely expressed the situation: ``The information used in data collection must be included in the analysis, or else inferences will not necessarily be appropriate for the general population of interest''. That is, the generalisability of results, to the ecological process, will be compromised if sampling artefacts are ignored.

In contrast, the NSW vegetation analysis showed that the model would be substantially altered -- both in terms of the model chosen to interpret (different number of RCPs), and even if the same number of RCPs were forced then the interpretation of those groups would be different. This naturally leads to the question: ``what effect does omission of sampling artefacts have on the interpretation of the RCP model?'' To address this question, we performed a small simulation study (presented in the Supplementary materials). When the sampling artefacts did not have any effect on the outcomes, then the two models behaved quite similarly. However, when there were artefacts present ignoring them adversely affected the model -- the model was biased in terms of predicting $\vpi_i$, and the associated measures of uncertainty where changed (sometimes it increased and sometimes decreased). In contrast, when the sampling effects were included, the predictions were stable for all simulated importance of sampling artefacts. These findings are in line with the observed patterns for the vegetation and fish analyses. In particular, the NSW analysis, with no sampling effects, gave some new RCPs and many of the RCPs had smaller prediction intervals. So, not including sampling artefacts can be a double-edged sword -- you can get biassed results \textit{and} be more confident about them.

Our model is general, but does not cover all eventualities. In particular, there is still a limited choice of error distributions and some data types (e.g. ordinal data) are not currently available. Also, we do not yet allow for the combined analysis of multiple data types, which would remove the need for degrading quantitative data to presence-absence in the NSW vegetation data. Such an analysis would have multiple likelihood functions and great care would need to be exerted to make sure that parameters have the same meaning in all likelihoods. Implementing this in a general way is non-trivial and would require a substantial, concerted effort, and solutions are likely to be problem specific. Perhaps the single biggest improvement to our modelling approach does not come through extension, but rather \textit{refinement}. In particular, the manner in which we include the sampling effects is on a per-species basis. These terms could be included into any model-based analysis, including the latent variable models \citep[e.g.][]{war15a}. It is possible, that many of the species will share similar responses to these effects and that an analyst could `borrow strength' across species by parameterising the model in such a way that reflects this. We have not explored this in this work, but a possible framework is given in \citet{dun11} and \citet{dun13}, which would converge aspects of grouping species and grouping sites \citep[and move towards the bi-clustering of][but based on judicious choices of covariates]{ple14}.

%We have made some pragmatic decisions in our analyses about how the model should be specified. For mixture models, and RCP models in particular, we feel that a workable solution to the problems of: 1) choosing the number of RCP groups, and 2) choosing which covariates should be included to describe the RCPs' distributions through covariate space, are in need of research attention. They are difficult problems, especially when tackled together, which have only been given cursory attention in this work -- our focus here was on the equally important question of sampling effects.

%Whilst we have introduced a method to account for sampling effects, we note that in doing so we have been forced to introduced a number of assumptions. Principally, these are concerned with the how sampling affects variation in the biological data; for example, that the sampling effects do not interact with the biogeographical effects, which can occur in surveys of migratory animals during different seasons. Assumptions are unavoidable in any data analysis, but it is best to keep them to a minimum and not to have the inferences resting on their validity. % We also feel that it is mandatory to know what the assumptions are -- the formality of specifying a model (like the one used in this work) necessitates this.%One way, and in our opinion the most robust and best, is to take excellent care of the process of designing the survey. In ecology, we can learn much from the ideas and methods employed in other areas, such as official statistics. 

%We have just listed a number of potential ways in which our models may not be appropriate for all data sets and analysis questions. Many of these points are ubiquitous to ecological analyses. However, they are made transparent by formally expressing a model for the analysis problem, which we interpret as a strength of the approach and note that formality results in a transparent and interpretable method for generating biogeographies. This follows the rationale outlined in \citet{war15}, which outlines a number of ways in which models can be beneficial. The residual checks (Section \ref{SectBoot}) adds further confidence in the results of the analysis. The model can be extended in any number of ways, again performed in a transparent manner.

\section*{Acknowledgements}

We valued the advice from, discussions with, and comments from, John McKinlay, Dirk Welsford, Adrien Ickowicz, David Peel, two anonymous referees, and the journal's editors.

\section*{Supplementary Materials}

Supplementary figures and tables, referenced throughout this work, are available from the journal's website. An R-package \verb|RCPmod| to perform estimation is available from CRAN (\verb|https://cran.r-project.org/|). The code and data to perform the specific analysis in this work are available from gitHub \verb|https://github.com/mitchest/rcp-cluster-parallelisation|.\vspace*{-8pt}

\bibliographystyle{rss}
\bibliography{/home/fos085/zoteroFiles/JabRefPDF/SDFReferences}

\end{document}
